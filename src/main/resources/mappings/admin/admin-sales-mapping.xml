<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdminSalesDAO">
	<resultMap type="com.thisisthat.admin.sales.vo.AdminSalesDataVO" id="salesDataVO">
		<result property="grouping" column="grouping"/>
		<result property="groupString" column="groupstring"/>
		<result property="subtotal" column="subtotal"/>
	</resultMap>
	<select id="getMontlySales" resultType="com.thisisthat.admin.sales.vo.AdminSalesDataVO">
		<![CDATA[
		select date_trunc('month',order_date) as grouping ,sum(order_price) as subtotal
		from order_table 
		where (order_state != '입금대기') 
		and  order_date >= #{startMonth}::date and order_date < #{endMonth}::date+INTERVAL'+1 month'
		group by date_trunc('month',order_date) 
		order by grouping
		]]>
	</select>
	
	<select id="getDailySales" resultType="com.thisisthat.admin.sales.vo.AdminSalesDataVO">
		<![CDATA[
			select date_trunc('day',order_date) as grouping ,sum(order_price) as subtotal
			from order_table 
			where (order_state != '입금대기') 
			and  order_date >= #{startDay}::date and order_date < #{endDay}::date+INTERVAL'+1 day'
			group by date_trunc('day',order_date) 
			order by grouping
		]]>
	</select>
	
	<select id="getCategorySales" resultType="com.thisisthat.admin.sales.vo.AdminSalesDataVO">
		<![CDATA[
		select sum(select_count) as subtotal,
			(select product_category from product as p where p.product_no = o.product_no) as groupString
		from order_product as o right outer join order_table as t on( o.order_no = t.order_no)
		where (order_state != '입금대기') and 
			order_date >= #{startDay}::date
			and 
			order_date <  #{endDay}::date+INTERVAL'+1 day'
		GROUP by groupString
		]]> 		
	</select>
	
	<select id="getDatelySales" resultMap="salesDataVO">
		<![CDATA[
		select to_char(order_date ,'Day')as groupstring,sum(order_price) as subtotal
			from order_table 
			where (order_state != '입금대기') 
			and  order_date >= #{startDay}::date and order_date < #{endDay}::date+INTERVAL'+1 day'
			group by groupstring
		]]>
	</select>
	
</mapper>
